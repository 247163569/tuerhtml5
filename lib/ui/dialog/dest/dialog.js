define("dialog",function(require,t,e){function i(t){var e=t[0].contentWindow.document;return e.body.scrollHeight&&e.documentElement.scrollHeight?Math.min(e.body.scrollHeight,e.documentElement.scrollHeight):e.documentElement.scrollHeight?e.documentElement.scrollHeight:e.body.scrollHeight?e.body.scrollHeight:void 0}function s(t){null===t.attr("tabindex")&&t.attr("tabindex","-1")}var n=sjs,r=require("overlay"),o=require("mask"),a="300px",h=function(t,e,i){return t.replace(i||/\\?\{([^{}]+)\}/g,function(t,i){return"\\"===t.charAt(0)?t.slice(1):void 0===e[i]?"":e[i]})},l=r.extend({attrs:{template:'<div class="{classPrefix}">                            <div class="{classPrefix}-close" title="关闭" data-role="close"></div>                            <div class="{classPrefix}-content" data-role="content"></div>                       </div>',trigger:{value:null,getter:function(t){return n(t)}},classPrefix:"ui-dialog",content:{value:"",setter:function(t){return/^(https?:\/\/|\/|\.\/|\.\.\/)/.test(t)&&(this._type="iframe"),t}},hasMask:!0,closeTpl:"x",width:500,height:null,effect:"none",zIndex:999,autoFit:!0,align:{selfXY:["50%","50%"],baseXY:["50%","50%"]}},parseElement:function(){this.set("model",{classPrefix:this.get("classPrefix")}),l.superclass.parseElement.call(this),this.contentElement=this.$("[data-role=content]"),this.contentElement.css({background:"#fff",height:"100%",zoom:1}),this.$("[data-role=close]").hide()},parseElementFromTemplate:function(){this.element=n(h(this.get("template"),this.get("model")))},events:{"click [data-role=close]":function(t){t.preventDefault(),this.hide()}},show:function(){return"iframe"===this._type&&(!this.get("height")&&this.element.css("height",a),this._showIframe()),l.superclass.show.call(this),this},hide:function(){return"iframe"===this._type&&this.iframe&&(this.iframe.attr({src:"javascript:'';"}),this.iframe.remove(),this.iframe=null),l.superclass.hide.call(this),clearInterval(this._interval),delete this._interval,this},destroy:function(){return this.element.remove(),this.get("hasMask")&&o.hide(),clearInterval(this._interval),l.superclass.destroy.call(this)},setup:function(){l.superclass.setup.call(this),this._setupTrigger(),this._setupMask(),this._setupKeyEvents(),this._setupFocus(),s(this.element),s(this.get("trigger")),this.activeTrigger=this.get("trigger").eq(0)},_onRenderContent:function(t){if("iframe"!==this._type){var e;try{e=n(t)}catch(i){e=[]}e[0]?this.contentElement.empty().append(e):this.contentElement.empty().html(t)}},_onRenderCloseTpl:function(t){""===t?this.$("[data-role=close]").html(t).hide():this.$("[data-role=close]").html(t).show()},_onRenderVisible:function(t){t?"fade"===this.get("effect")?this.element.fadeIn(300):this.element.show():this.element.hide()},_setupTrigger:function(){this.delegateEvents(this.get("trigger"),"click",function(t){t.preventDefault(),this.activeTrigger=n(t.currentTarget),this.show()})},_setupMask:function(){var t,e=this.get("hasMask"),i=parseInt(this.get("zIndex"),10);this.before("show",function(){e&&(t=o.get("zIndex"),o.set("zIndex",i-1).show())}),this.after("hide",function(){e&&o.set("zIndex",t).hide()})},_setupFocus:function(){this.after("show",function(){this.element.focus()}),this.after("hide",function(){this.activeTrigger&&this.activeTrigger.focus()})},_setupKeyEvents:function(){this.delegateEvents(n(document),"keyup",function(t){27===t.keyCode&&this.get("visible")&&this.hide()})},_showIframe:function(){var t=this;this.iframe||this._createIframe(),this.iframe.attr({src:this._fixUrl(),name:"dialog-iframe"+(new Date).getTime()}),this.iframe.one("load",function(){t.get("visible")&&(t.get("autoFit")&&(clearInterval(t._interval),t._interval=setInterval(function(){t._syncHeight()},300)),t._syncHeight(),t._setPosition(),t.trigger("complete:show"))})},_fixUrl:function(){var t=this.get("content").match(/([^?#]*)(\?[^#]*)?(#.*)?/);return t.shift(),t[1]=(t[1]&&"?"!==t[1]?t[1]+"&":"?")+"t="+(new Date).getTime(),t.join("")},_createIframe:function(){var t=this;this.iframe=n("<iframe>",{src:"javascript:'';",scrolling:"no",frameborder:"no",allowTransparency:"true"}).css({border:"none",width:"100%",display:"block",height:"100%",overflow:"hidden"}).appendTo(this.contentElement),n(this.iframe[0]).on("close",function(){t.hide()})},_syncHeight:function(){var t;if(this.get("height"))clearInterval(this._interval),delete this._interval;else{try{this._errCount=0,t=i(this.iframe)+"px"}catch(e){this._errCount=(this._errCount||0)+1,this._errCount>=6&&(t=a,clearInterval(this._interval),delete this._interval)}this.element.css("height",t),this.element[0].className=this.element[0].className}}});e.exports=l});