define("overlay",function(require,t,e){function i(t){return r.contains(document.documentElement,t)}function n(t){r(h.blurOverlays).each(function(e,i){if(i&&i.get("visible")){for(var n=0;i._relativeElements.length>n;n++){var s=r(i._relativeElements[n])[0];if(s===t.target||r.contains(s,t.target))return}i.hide()}})}function s(t,e){for(var i=0;e.length>i;i++)if(t===e[i])return e.splice(i,1),e;return e}var r=sjs,o=require("position"),a=require("iframe-shim"),h=sjs.UI.extend({attrs:{width:"",height:"",zIndex:99,visible:!1,align:{selfXY:[0,0],baseElement:o.VIEWPORT,baseXY:[0,0]},parentNode:"body"},show:function(){return this.rendered||this.render(),this.set("visible",!0),this},hide:function(){return this.set("visible",!1),this},setup:function(){var t=this;this._setupShim(),this._setupResize(),this.after("show",function(){t._setPosition()})},destroy:function(){return s(this,h.allOverlays),s(this,h.blurOverlays),h.superclass.destroy.call(this)},_setPosition:function(t){if(!i(this.element[0]))return this;if(t||(t=this.get("align")),!t)return this;var e="none"===this.element.css("display");return e&&this.element.css({visiblility:"hidden",display:"block"}),o.pin({element:this.element,x:t.selfXY[0],y:t.selfXY[1]},{element:t.baseElement,x:t.baseXY[0],y:t.baseXY[1]}),e&&this.element.css({visiblility:"",display:"none"}),this},_setupShim:function(){var t=new a(this.element);this.after("hide",t.sync,t),this.after("_setPosition",t.sync,t);var e=["width","height"];for(var i in e)e.hasOwnProperty(i)&&this.on("change:"+i,t.sync,t);this.before("destroy",t.destroy,t)},_setupResize:function(){h.allOverlays.push(this)},_blurHide:function(t){t=r.makeArray(t),t.push(this.element),this._relativeElements=t,h.blurOverlays.push(this)},_onRenderWidth:function(t){this.element.css("width",t)},_onRenderHeight:function(t){this.element.css("height",t)},_onRenderZIndex:function(t){this.element.css("zIndex",t)},_onRenderAlign:function(t){this._setPosition(t)},_onRenderVisible:function(t){this.element[t?"show":"hide"]()},Statics:{blurOverlays:[],allOverlays:[]}});r(document).on("click",function(t){n(t)});var l;r(window).resize(function(){l&&clearTimeout(l),l=setTimeout(function(){r(h.allOverlays).each(function(t,e){e&&e.get("visible")&&e._setPosition()})},80)}),e.exports=h});